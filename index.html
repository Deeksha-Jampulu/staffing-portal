<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simarn Staffing Portal - Dashboard</title>
  <link rel="stylesheet" href="style.css?v=999" />
</head>
<body>

  <nav class="topbar">
    <div class="brand">
      <img src="logo.png" alt="Simarn Logo" />
      <span>Simarn Staffing Portal</span>
    </div>

    <div class="nav-links">
      <a class="active" href="index.html">Dashboard</a>
      <a href="candidates.html">Candidates</a>
      <a href="rtrs.html">RTRs</a>
      <a href="recruiters.html">Recruiters</a>
    </div>
  </nav>

  <div class="container">

    <div class="card hero">
      <div class="hero-text">
        <h1>Recruiting Snapshot</h1>
        <p style="margin:0;color:#6b7280;">
          Track candidates, RTR completions, submissions, and your most active roles â€” all in one clean dashboard.
        </p>
      </div>

      <div class="hero-img">
        <!-- Put a real image file in your folder: team.png -->
        <img src="team.png" alt="Team" />
      </div>
    </div>

    <!-- KPI cards -->
    <div class="kpi-grid">
      <div class="card kpi">
        <div class="kpi-title">Total Candidates</div>
        <div class="kpi-value" id="kpiCandidates">0</div>
        <div class="kpi-sub">All added profiles</div>
      </div>

      <div class="card kpi">
        <div class="kpi-title">RTRs Completed</div>
        <div class="kpi-value" id="kpiRtrs">0</div>
        <div class="kpi-sub">Total RTR records</div>
      </div>

      <div class="card kpi">
        <div class="kpi-title">Submissions</div>
        <div class="kpi-value" id="kpiSubs">0</div>
        <div class="kpi-sub">Total submissions</div>
      </div>

      <div class="card kpi">
        <div class="kpi-title">RTR Coverage</div>
        <div class="kpi-value" id="kpiCoverage">0/0</div>
        <div class="kpi-sub"># candidates with RTR / total candidates</div>
      </div>
    </div>

    <!-- Charts area (keep your existing charts if you already have them) -->
    <div class="grid-2">
      <div class="card">
        <h2 style="margin:0 0 10px;">Candidates by Domain/Role</h2>
        <canvas id="chartRoles" height="140"></canvas>
      </div>

      <div class="card">
        <h2 style="margin:0 0 10px;">RTR Coverage</h2>
        <canvas id="chartRtr" height="140"></canvas>
      </div>
    </div>

  </div>

  <script src="app.js"></script>
  <!-- If you use Chart.js, include it. If not, remove this line. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Simple dashboard loader (uses your API)
    async function loadDashboard(){
      const cand = await apiGet("candidates");
      const rtrs = await apiGet("rtrs");
      const subs = await apiGet("submissions"); // if not supported, you can remove this

      const candidates = (cand?.data || []);
      const rtrList = (rtrs?.data || []);
      const submissions = (subs?.data || []);

      document.getElementById("kpiCandidates").textContent = candidates.length;
      document.getElementById("kpiRtrs").textContent = rtrList.length;
      document.getElementById("kpiSubs").textContent = submissions.length;

      const covered = new Set(rtrList.map(x => x.candidate || x.candidate_name || x.name));
      document.getElementById("kpiCoverage").textContent = `${covered.size}/${candidates.length}`;

      // Chart: candidates by domain_role
      const counts = {};
      candidates.forEach(c => {
        const k = (c.domain_role || "Unknown").trim();
        counts[k] = (counts[k] || 0) + 1;
      });

      const roleLabels = Object.keys(counts);
      const roleValues = Object.values(counts);

      // Bar chart
      new Chart(document.getElementById("chartRoles"), {
        type: "bar",
        data: { labels: roleLabels, datasets: [{ label: "Candidates", data: roleValues }] },
        options: { responsive:true, plugins:{ legend:{ display:false } } }
      });

      // Doughnut chart: RTR coverage
      new Chart(document.getElementById("chartRtr"), {
        type: "doughnut",
        data: {
          labels: ["RTR Done", "Pending"],
          datasets: [{
            data: [covered.size, Math.max(0, candidates.length - covered.size)]
          }]
        },
        options: { responsive:true }
      });
    }

    loadDashboard();
  </script>
</body>
</html>
