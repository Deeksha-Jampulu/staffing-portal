<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Candidates</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <a href="index.html">Dashboard</a>
    <a href="candidates.html">Candidates</a>
    <a href="recruiters.html">Recruiters</a>
  </nav>

  <div class="container">
    <div class="card">
      <h1>Candidates</h1>
      <p class="small">Add candidate + store resume as Google Drive link.</p>

      <!-- Add Candidate Form -->
      <div class="card">
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <input id="full_name" placeholder="Full name" style="flex:1; min-width:220px;" />
          <input id="email" placeholder="Email" style="flex:1; min-width:220px;" />
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <input id="phone" placeholder="Phone" style="flex:1; min-width:220px;" />
          <input id="location" placeholder="Location" style="flex:1; min-width:220px;" />
          <input id="domain_role" placeholder="Domain / Role (QA, Oracle, Java)" />
          <textarea id="notes" placeholder="Notes about candidate"></textarea>

        </div>

        <div style="margin-top:10px;">
          <input id="resume_link" placeholder="Resume link (Google Drive link)" style="width:100%;" />
        </div>

        <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
          <button id="addBtn">Add Candidate</button>
          <span id="msg" class="small"></span>
        </div>
      </div>

      <!-- Search -->
      <div style="margin-top:14px;">
        <input id="search" placeholder="Search by name/email..." style="width:100%;" />
      </div>

      <!-- Candidates Table -->
      <div class="card" style="margin-top:14px; overflow:auto;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Name</th>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Email</th>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Phone</th>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Location</th>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Resume</th>
              <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Created</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

    </div>
  </div>
<script src="app.js"></script>
<script>
  let all = [];

  async function loadCandidates() {
    const r = await apiGet("candidates");
    all = (r && r.ok) ? (r.data || []) : [];
    renderCandidates();
  }

  function renderCandidates() {
    const q = (document.getElementById("search")?.value || "").toLowerCase();
    const rows = (all || []).filter(c =>
      String(c.full_name || "").toLowerCase().includes(q) ||
      String(c.email || "").toLowerCase().includes(q)
    );

    document.getElementById("rows").innerHTML = rows.map(c => `
      <tr>
        <td>${esc(c.full_name)}</td>
        <td>${esc(c.email)}</td>
        <td>${esc(c.phone)}</td>
        <td>${esc(c.location)}</td>
        <td>${c.resume_link ? `<a href="${esc(c.resume_link)}" target="_blank">View</a>` : `<span class="small">No link</span>`}</td>
        <td class="small">${esc(c.created_at)}</td>
      </tr>
    `).join("");
  }

  async function addCandidate() {
    const msg = document.getElementById("msg");
    msg.textContent = "Saving...";

    const full_name = document.getElementById("full_name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const location = document.getElementById("location").value.trim();
    const resume_link = document.getElementById("resume_link").value.trim();

    if (!full_name) {
      msg.textContent = "Name is required";
      return;
    }

    try {
      const r = await apiPost({
        route: "add_candidate",
        full_name, email, phone, location, resume_link
      });

      if (r && r.ok) {
        msg.textContent = "Added âœ…";
        document.getElementById("full_name").value = "";
        document.getElementById("email").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("location").value = "";
        document.getElementById("resume_link").value = "";
        await loadCandidates();
      } else {
        msg.textContent = "Error: " + (r?.error || "Unknown");
      }
    } catch (e) {
      msg.textContent = "Error: " + e.message;
      console.error(e);
    }
  }

  // wire up button
  document.getElementById("addBtn").addEventListener("click", addCandidate);

  // wire up search (if present)
  const s = document.getElementById("search");
  if (s) s.addEventListener("input", renderCandidates);

  // initial load
  loadCandidates();
</script>

