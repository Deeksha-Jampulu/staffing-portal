<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candidates</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <nav>
    <a href="index.html">Dashboard</a>
    <a href="candidates.html"><b>Candidates</b></a>
    <a href="recruiters.html">Recruiters</a>
  </nav>

  <div class="container">
    <div class="card">
      <h1>Candidates</h1>

      <h3>Add Candidate</h3>
      <div class="form">
        <input id="name" placeholder="Name *" />
        <input id="email" placeholder="Email" />
        <input id="phone" placeholder="Phone" />
        <input id="location" placeholder="Location" />
        <input id="domain_role" placeholder="Domain / Role (QA, Oracle, Java)" />
        <textarea id="notes" placeholder="Notes about candidate" rows="3"></textarea>
        <input id="resume_link" placeholder="Resume Link (Google Drive link)" />
        <button id="addBtn">Add Candidate</button>
        <p class="small" id="msg"></p>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <h3>Candidate List</h3>

      <table border="1" width="100%" cellpadding="8" cellspacing="0">
        <thead>
          <tr>
            <th>Name</th>
            <th>Domain/Role</th>
            <th>Location</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Resume</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="candRows"></tbody>
      </table>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    async function loadCandidates() {
      const msg = document.getElementById("msg");
      msg.textContent = "";

      try {
        const r = await apiGet("candidates");
        if (!r || r.ok === false) {
          msg.textContent = "Error loading candidates";
          return;
        }

        const tbody = document.getElementById("candRows");
        tbody.innerHTML = "";

        (r.data || []).forEach(c => {
          const resumeCell = c.resume_link
            ? `<a href="${c.resume_link}" target="_blank">View</a>`
            : "-";

          tbody.innerHTML += `
            <tr>
              <td>${c.name || ""}</td>
              <td>${c.domain_role || ""}</td>
              <td>${c.location || ""}</td>
              <td>${c.email || ""}</td>
              <td>${c.phone || ""}</td>
              <td>${resumeCell}</td>
              <td>${c.notes || ""}</td>
            </tr>
          `;
        });
      } catch (e) {
        console.error(e);
        msg.textContent = "Error: API failed to load";
      }
    }

    async function addCandidate() {
      const msg = document.getElementById("msg");
      const btn = document.getElementById("addBtn");
      msg.textContent = "Saving...";
      btn.disabled = true;

      const payload = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        location: document.getElementById("location").value.trim(),
        domain_role: document.getElementById("domain_role").value.trim(),
        notes: document.getElementById("notes").value.trim(),
        resume_link: document.getElementById("resume_link").value.trim()
      };

      if (!payload.name) {
        msg.textContent = "Name is required";
        btn.disabled = false;
        return;
      }

      try {
        const r = await apiPost("addCandidate", payload);
        if (!r || r.ok === false) {
          msg.textContent = "Error saving candidate";
          btn.disabled = false;
          return;
        }

        msg.textContent = "Added âœ…";
        document.getElementById("name").value = "";
        document.getElementById("email").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("location").value = "";
        document.getElementById("domain_role").value = "";
        document.getElementById("notes").value = "";
        document.getElementById("resume_link").value = "";

        await loadCandidates();
      } catch (e) {
        console.error(e);
        msg.textContent = "Error: API failed to load";
      } finally {
        btn.disabled = false;
      }
    }

    document.getElementById("addBtn").addEventListener("click", addCandidate);
    loadCandidates();
  </script>
</body>
</html>
